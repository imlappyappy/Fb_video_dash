{
  "pluginType": "DB",
  "pluginId": "postgres-plugin",
  "unpublishedAction": {
    "name": "Channel_total_views",
    "datasource": {
      "pluginId": "postgres-plugin",
      "messages": [],
      "isAutoGenerated": false,
      "id": "Fb_video_dashboard_datasrc",
      "deleted": false,
      "policies": [],
      "userPermissions": []
    },
    "pageId": "Facebook",
    "actionConfiguration": {
      "timeoutInMillisecond": 20000,
      "paginationType": "NONE",
      "encodeParamsToggle": true,
      "body": "with CTE_sumtotal as (\n\tSELECT (case EXTRACT(month FROM date_trunc('month',view_date)) when '1' THEN 'Jan'\n\t\t\t\twhen '2' THEN 'Feb'\n\t\t\t\twhen '3' THEN 'Mar'\n\t\t\t\twhen '4' THEN 'Apr'\n\t\t\t\twhen '5' THEN 'May'\n\t\t\t\twhen '6' THEN 'June'\n\t\t\t\twhen '7' THEN 'July'\n\t\t\t\twhen '8' THEN 'Aug'\n\t\t\t\twhen '9' THEN 'Sept'\n\t\t\t\twhen '10' THEN 'Oct'\n\t\t\t\twhen '11' THEN 'Nov'\n\t\t\t\twhen '12' THEN 'Dec'\n\t\t\t\tEND) as Month,\n\tvideo_id,title,name,created_time,\n\tcast(total_video_views as decimal) as Total_Video_Views,\n\tcast(total_video_view_total_time as decimal) as Total_Watch_Hrs,\n\tcast(total_video_impressions as decimal)/1000 as Revenue\n\tFROM public.smg_dmp_fb_video_dashboard_unq_view \n\tWHERE case when '{{End_date.selectedDate}}':: date > '{{moment().add(-1,'day')}}':: date\n\t\tthen view_date = '{{moment().add(-1,'day')}}':: date \n\telse \n\t\tview_date = '{{End_date.selectedDate}}':: date end\n\t\t\tAND name like {{Domain_select.selectedOptionValue ? Domain_select.selectedOptionValue : \"%\"}}),\nCTE_view_date as (\n\tSELECT (case EXTRACT(month FROM date_trunc('month',view_date)) when '1' THEN 'Jan'\n\t\t\t\twhen '2' THEN 'Feb'\n\t\t\t\twhen '3' THEN 'Mar'\n\t\t\t\twhen '4' THEN 'Apr'\n\t\t\t\twhen '5' THEN 'May'\n\t\t\t\twhen '6' THEN 'June'\n\t\t\t\twhen '7' THEN 'July'\n\t\t\t\twhen '8' THEN 'Aug'\n\t\t\t\twhen '9' THEN 'Sept'\n\t\t\t\twhen '10' THEN 'Oct'\n\t\t\t\twhen '11' THEN 'Nov'\n\t\t\t\twhen '12' THEN 'Dec'\n\t\t\t\tEND) as Month,\n\tvideo_id,title,name,created_time,\n\tcast(total_video_views as decimal) as Total_Video_Views,\n\tcast(total_video_view_total_time as decimal) as Total_Watch_Hrs,\n\tcast(total_video_impressions as decimal)/1000 as Revenue\n\tFROM public.smg_dmp_fb_video_dashboard_unq_view \n\tWHERE case when '{{Start_date.selectedDate}}':: date > '{{moment().add(-2,'day')}}':: date\n\t\tthen view_date = '{{moment().add(-1,'day')}}':: date \n\telse \n\t\tview_date = '{{Start_date.selectedDate}}':: date end\n\t\t\tAND name like {{Domain_select.selectedOptionValue ? Domain_select.selectedOptionValue : \"%\"}})\nSELECT * FROM(\n\tselect coalesce(CTE_sumtotal.name,CTE_view_date.name) as channel,\nCTE_sumtotal.month as Months,\nSUM(CTE_sumtotal.Total_Video_Views-coalesce(CTE_view_date.Total_Video_Views,0)) as Views,\nSUM(CTE_sumtotal.Total_Watch_Hrs-coalesce(CTE_view_date.Total_Watch_Hrs,0)) as Watch_Hrs,\nSUM(CTE_sumtotal.Revenue-coalesce(CTE_view_date.Revenue,0)) as Revenue\nfrom CTE_sumtotal FULL join CTE_view_date on CTE_sumtotal.video_id=CTE_view_date.video_id\n\twhere coalesce(CTE_sumtotal.name,CTE_view_date.name) is not null and\n\tCTE_sumtotal.month is not null\n\tand CTE_sumtotal.Total_Video_Views-coalesce(CTE_view_date.Total_Video_Views,0) > 0\ngroup by channel,Months\norder by channel)\nAS T\nUNION ALL\nselect 'Total','Month',\nSUM(CTE_sumtotal.Total_Video_Views-coalesce(CTE_view_date.Total_Video_Views,0)),\nSUM(CTE_sumtotal.Total_Watch_Hrs-coalesce(CTE_view_date.Total_Watch_Hrs,0)),\nSUM(CTE_sumtotal.Revenue-coalesce(CTE_view_date.Revenue,0))\nfrom CTE_sumtotal FULL join CTE_view_date on CTE_sumtotal.video_id=CTE_view_date.video_id;"
    },
    "executeOnLoad": true,
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "isValid": true,
    "invalids": [],
    "messages": [],
    "jsonPathKeys": [
      "Domain_select.selectedOptionValue ? Domain_select.selectedOptionValue : \"%\"",
      "End_date.selectedDate",
      "Start_date.selectedDate",
      "moment().add(-1,'day')",
      "moment().add(-2,'day')"
    ],
    "userSetOnLoad": false,
    "confirmBeforeExecute": false,
    "policies": [],
    "userPermissions": []
  },
  "id": "Facebook_Channel_total_views",
  "deleted": false,
  "gitSyncId": "62837f843cd70e097b62341a_62b9989e4c1f4b56d4d33d88"
}